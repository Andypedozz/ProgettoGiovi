---
import "../styles/login.css"
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <div>
        <!-- Login Container -->
        <div class="login-container">
            <div class="login-form-container">
                <div class="brand">
                    <div class="subtitle">PORTALE ADMIN</div>
                </div>

                <h2>Admin</h2>
                <p>Inserisci le tue credenziali per accedere alla dashboard</p>

                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label
                        >
                        <input
                            type="text"
                            id="email"
                            name="email"
                            class="form-input"
                            placeholder="Email"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="password" class="form-label">Password</label
                        >
                        <input
                            type="password"
                            id="password"
                            name="password"
                            class="form-input"
                            placeholder="Password"
                            required
                        />
                        <button
                            type="button"
                            class="password-toggle"
                            id="togglePassword"
                        >
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>

                    <button type="submit" class="login-button">
                        <span>Accedi</span>
                    </button>

                    <div class="login-options">
                        <label class="remember-me">
                            <input type="checkbox" id="remember" />
                            <span>Ricordami</span>
                        </label>
                        <a href="#" class="forgot-password"
                            >Password dimenticata?</a
                        >
                    </div>
                    <div>
                        <a href="/" class="forgot-password">Torna alla home</a>
                    </div>
                </form>
                <p id="loginResult"></p>
            </div>
        </div>
        <script is:inline>
            async function submitForm(formId, apiEndpoint, resultId) {
                const form = document.getElementById(formId);
                form.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const data = Object.fromEntries(new FormData(form));

                    const res = await fetch(apiEndpoint, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data),
                    });

                    document.getElementById(resultId).textContent = (res.ok)? "Login avvenuto con successo" : "Credenziali non valide!";

                    if (res.ok) {
                        // ricarico la pagina protetta dopo login/registrazione
                        setTimeout(() => {
                            window.location.href = "/admin";
                        }, 800);
                    }
                });
            }

            submitForm("loginForm", "/api/login", "loginResult");
        </script>
    </div>
</Layout>
