---
import "../styles/signup.css"
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <div>
        <!-- Login Container -->
        <div class="login-container">
            <div class="login-form-container">
                <div class="brand">
                    <div class="subtitle">PORTALE</div>
                </div>

                <h2>Crea un Account</h2>
                <p>Inserisci le tue credenziali per accedere alla dashboard</p>

                <form id="signupForm" class="login-form">
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input
                            type="text"
                            id="email"
                            name="email"
                            class="form-input"
                            placeholder="Email"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="password" class="form-label">Password</label
                        >
                        <input
                            type="password"
                            id="password"
                            name="password"
                            class="form-input"
                            placeholder="Password"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="role" class="form-label">Ruolo</label>
                        <select class="form-select" name="role" id="role">
                            <optgroup>
                                <option value="user">Utente</option>
                                <option value="admin">Amministratore</option>
                            </optgroup>
                        </select>
                    </div>

                    <button type="submit" class="login-button">
                        <span>Registrati</span>
                    </button>

                    <div class="login-options">
                        <label class="remember-me">
                            <input type="checkbox" id="remember" />
                            <span>Ricordami</span>
                        </label>
                        <a href="#" class="forgot-password"
                            >Password dimenticata?</a
                        >
                    </div>
                    <div>
                        <a href="/" class="forgot-password">Torna alla home</a>
                    </div>
                </form>
                <p id="registerResult"></p>
            </div>
        </div>
        <script is:inline>
            async function submitForm(formId, apiEndpoint, resultId) {
                const form = document.getElementById(formId);
                form.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const data = Object.fromEntries(new FormData(form));

                    const res = await fetch(apiEndpoint, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data),
                    });

                    if (res.ok) {
                        // ricarico la pagina protetta dopo login/registrazione
                        setTimeout(() => {
                            window.location.href = "/admin";
                        }, 800);
                    }
                });
            }

            submitForm("signupForm", "/api/register", "registerResult");
        </script>
    </div>
</Layout>
